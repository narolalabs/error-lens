"use strict";

$.ajaxSetup({
    headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    }
});


$(function () {
  	createSticky( $('#sticky-wrap') );
});


$(document).ready(function() {
	if ( $('.full-log-view').length ) {
		setTimeout(() => {
		    hljs.highlightAll();
		}, 1000);
	}
});

$(document).on('click', '.view-error', function(event) {
	event.preventDefault();
	event.stopPropagation()
	let url = $(this).attr('href');

	if ( url ) {
		$.ajax({
			url: url,
			type: 'get',
			dataType: 'json',
			catch: false,
			async: false,
			success: function (response) {
				if ( response.status ) {
					makeModal('view-error-modal', 'view-error-modal w-75', response.data.view, 'modal-lg', true);
					
					setTimeout(() => {
					    hljs.highlightAll();
					}, 1000);

				}
			}
		});	
	}
});

$(document).on('click', '.view-more', function(event) {
    event.preventDefault();
    $('.exception-trace-wrapper').toggleClass('in')

    $('.exception-trace-wrapper').hasClass('in') ?
    	$(this).html('View more') :
    	$(this).html('View less');

});

$(document).on('click', '.sidebar-view-more', function(event) {
    event.preventDefault();
    let $elem = $(this).parent().find('.content');
    $elem.toggleClass('line-clamp-3')

    $elem.hasClass('line-clamp-3') ?
    	$(this).html('View more') :
    	$(this).html('View less');

});

function createSticky(sticky) {
	if ( sticky.length ) {
		if (typeof sticky != "undefined") {
			var pos = sticky.offset().top + 125,
			win = jQuery(window);

			// scroll should really be throttled
			// See https://codepen.io/paulobrien/pen/OJWKvQO for a throttled version
	    	win.on("scroll", function () {
	    		if (win.scrollTop() > pos) {
	    			sticky.addClass("stickyhead");
	    		} 
	    		if (win.scrollTop() < pos -50)  {
	    			sticky.removeClass("stickyhead");
	    		}
	    	});
	    }
	}
}
